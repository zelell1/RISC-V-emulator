# RISC-V Emulator

–ü—Ä–æ–≥—Ä–∞–º–º–Ω—ã–π —ç–º—É–ª—è—Ç–æ—Ä –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã **RISC-V** (–Ω–∞–±–æ—Ä –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π **RV32I**). –ü—Ä–æ–µ–∫—Ç —Ä–µ–∞–ª–∏–∑—É–µ—Ç —Ü–∏–∫–ª –≤—ã–±–æ—Ä–∫–∏ –∏ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π (Fetch-Decode-Execute), —Ä–∞–±–æ—Ç—É —Å —Ä–µ–≥–∏—Å—Ç—Ä–∞–º–∏ –∏ –ø–∞–º—è—Ç—å—é.

## üìã –û–ø–∏—Å–∞–Ω–∏–µ

–≠—Ç–æ—Ç —ç–º—É–ª—è—Ç–æ—Ä –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å –±–∏–Ω–∞—Ä–Ω—ã–µ —Ñ–∞–π–ª—ã (–∏–ª–∏ —Ñ–∞–π–ª—ã —Å –º–∞—à–∏–Ω–Ω—ã–º –∫–æ–¥–æ–º), —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–ª—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã RISC-V, –Ω–∞ –æ–±—ã—á–Ω–æ–º –ü–ö. –û—Å–Ω–æ–≤–Ω–∞—è —Ü–µ–ª—å –ø—Ä–æ–µ–∫—Ç–∞ ‚Äî –∏–∑—É—á–µ–Ω–∏–µ –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤ —Ä–∞–±–æ—Ç—ã –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–æ–≤, –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π –∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –ø–∞–º—è—Ç–∏.

### –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:
*   **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:** 32-–±–∏—Ç–Ω–∞—è (RV32I Base Integer Instruction Set).
*   **–†–µ–≥–∏—Å—Ç—Ä—ã:** –≠–º—É–ª—è—Ü–∏—è 32 —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤ –æ–±—â–µ–≥–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è (`x0` - `x31`) + Program Counter (`PC`).
*   **–ü–∞–º—è—Ç—å:** –≠–º—É–ª—è—Ü–∏—è –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–º—è—Ç–∏ (RAM) —Å –ø–æ–±–∞–π—Ç–æ–≤—ã–º –¥–æ—Å—Ç—É–ø–æ–º (Little-endian).
*   **–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏:** –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –æ—Å–Ω–æ–≤–Ω—ã—Ö –≥—Ä—É–ø–ø –∫–æ–º–∞–Ω–¥:
    *   –ê—Ä–∏—Ñ–º–µ—Ç–∏—á–µ—Å–∫–∏–µ –∏ –ª–æ–≥–∏—á–µ—Å–∫–∏–µ (ADD, SUB, XOR, OR, AND, SLL, SRL, SRA).
    *   –û–ø–µ—Ä–∞—Ü–∏–∏ —Å –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω—ã–º –∑–Ω–∞—á–µ–Ω–∏–µ–º (ADDI, XORI, SLTI –∏ –¥—Ä.).
    *   –ó–∞–≥—Ä—É–∑–∫–∞ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ (LB, LH, LW, SB, SH, SW).
    *   –í–µ—Ç–≤–ª–µ–Ω–∏—è –∏ –ø–µ—Ä–µ—Ö–æ–¥—ã (BEQ, BNE, BLT, JAL, JALR).
    *   –ö–æ–º–∞–Ω–¥—ã –æ–∫—Ä—É–∂–µ–Ω–∏—è (ECALL/EBREAK) ‚Äî *–±–∞–∑–æ–≤–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞*.

## üõ† –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

*   `src/` ‚Äî –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ —ç–º—É–ª—è—Ç–æ—Ä–∞.
*   `include/` ‚Äî –ó–∞–≥–æ–ª–æ–≤–æ—á–Ω—ã–µ —Ñ–∞–π–ª—ã (–æ–ø–∏—Å–∞–Ω–∏—è –∫–ª–∞—Å—Å–æ–≤ CPU, Memory, Decoder).
*   `tests/` ‚Äî –ü—Ä–∏–º–µ—Ä—ã –∞—Å—Å–µ–º–±–ª–µ—Ä–Ω–æ–≥–æ –∫–æ–¥–∞ –∏ –±–∏–Ω–∞—Ä–Ω—ã–µ —Ñ–∞–π–ª—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.
*   `main.cpp` ‚Äî –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –≤ –ø—Ä–æ–≥—Ä–∞–º–º—É.

## üöÄ –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
*   –ö–æ–º–ø–∏–ª—è—Ç–æ—Ä C++ (GCC –∏–ª–∏ Clang) c –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞ C++11 –∏ –≤—ã—à–µ.
*   Make (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –µ—Å–ª–∏ –µ—Å—Ç—å Makefile).

### –ö–æ–º–ø–∏–ª—è—Ü–∏—è (—á–µ—Ä–µ–∑ g++)

```bash
g++ -std=c++17 main.cpp -o riscv_emu
```

*(–ï—Å–ª–∏ —É —Ç–µ–±—è –ø—Ä–æ–µ–∫—Ç —Ä–∞–∑–±–∏—Ç –Ω–∞ –º–Ω–æ–≥–æ —Ñ–∞–π–ª–æ–≤, –Ω–∞–ø—Ä–∏–º–µ—Ä cpu.cpp, memory.cpp, –∏—Å–ø–æ–ª—å–∑—É–π –∫–æ–º–∞–Ω–¥—É –Ω–∏–∂–µ)*:
```bash
g++ -std=c++17 *.cpp -o riscv_emu
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

–ó–∞–ø—É—Å–∫ —ç–º—É–ª—è—Ç–æ—Ä–∞ —Å –≤—Ö–æ–¥–Ω—ã–º –±–∏–Ω–∞—Ä–Ω—ã–º —Ñ–∞–π–ª–æ–º:

```bash
./riscv_emu program.bin
```

## üíª –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã

–ù–∞ –≤—Ö–æ–¥–µ –ø–æ–¥–∞–µ—Ç—Å—è –±–∏–Ω–∞—Ä–Ω—ã–π —Ñ–∞–π–ª, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏. –≠–º—É–ª—è—Ç–æ—Ä –≤—ã–≤–æ–¥–∏—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤ –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:

```text
PC: 0x00000004
Instruction: add x1, x2, x3

Registers:
x0:  0x00000000    x8:  0x00000000
x1:  0x0000000A    x9:  0x00000000
x2:  0x00000005    x10: 0x00000000
x3:  0x00000005    x11: 0x00000000
...
```

## üîç –î–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

–≠–º—É–ª—è—Ç–æ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–º—É —Ü–∏–∫–ª—É –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞:
1.  **Fetch:** –ß—Ç–µ–Ω–∏–µ 4 –±–∞–π—Ç –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –∏–∑ –ø–∞–º—è—Ç–∏ –ø–æ –∞–¥—Ä–µ—Å—É `PC`.
2.  **Decode:** –†–∞–∑–±–æ—Ä –æ–ø–∫–æ–¥–∞ (opcode), –ø–æ–ª–µ–π `funct3`, `funct7` –∏ –æ–ø–µ—Ä–∞–Ω–¥–æ–≤ (`rd`, `rs1`, `rs2`).
3.  **Execute:** –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ –ê–õ–£.
4.  **Memory Access:** –ß—Ç–µ–Ω–∏–µ/–∑–∞–ø–∏—Å—å –≤ –ø–∞–º—è—Ç—å (–µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è).
5.  **Write Back:** –ó–∞–ø–∏—Å—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –≤ —Ä–µ–≥–∏—Å—Ç—Ä –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è.
